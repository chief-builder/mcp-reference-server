<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Observability API | MCP Reference Server</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Observability API" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A learning project implementing the Model Context Protocol (MCP) 2025-11-25 specification" />
<meta property="og:description" content="A learning project implementing the Model Context Protocol (MCP) 2025-11-25 specification" />
<link rel="canonical" href="http://localhost:4000/api/observability.html" />
<meta property="og:url" content="http://localhost:4000/api/observability.html" />
<meta property="og:site_name" content="MCP Reference Server" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Observability API" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"A learning project implementing the Model Context Protocol (MCP) 2025-11-25 specification","headline":"Observability API","url":"http://localhost:4000/api/observability.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=4084654cb939e8940665a91c4c56b28d8f437143">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="http://localhost:4000/">MCP Reference Server</a></h1>

        

        <p>A learning project implementing the Model Context Protocol (MCP) 2025-11-25 specification</p>

        
        <p class="view"><a href="https://github.com/chiefbuilder/mcp-reference-server">View the Project on GitHub <small>chiefbuilder/mcp-reference-server</small></a></p>
        

        

        
      </header>
      <section>

      <h1 id="observability-api-reference">Observability API Reference</h1>

<p>Exports for health checks, metrics collection, and distributed tracing.</p>

<h2 id="health-checks-observabilityhealth">Health Checks (<code class="language-plaintext highlighter-rouge">observability/health</code>)</h2>

<h3 id="healthchecker-class">HealthChecker Class</h3>

<p>Manages health checks for the MCP server with liveness and readiness endpoints.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">HealthChecker</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">?:</span> <span class="p">{</span> <span class="nx">version</span><span class="p">?:</span> <span class="kr">string</span> <span class="p">});</span>

  <span class="cm">/** Register a health check */</span>
  <span class="nx">registerCheck</span><span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">check</span><span class="p">:</span> <span class="nx">HealthCheckFn</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>

  <span class="cm">/** Unregister a health check */</span>
  <span class="nx">unregisterCheck</span><span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>

  <span class="cm">/** Run all registered checks */</span>
  <span class="nx">runChecks</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">HealthCheckResponse</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="cm">/** Quick liveness check (always true if process is running) */</span>
  <span class="nx">isAlive</span><span class="p">():</span> <span class="nx">boolean</span><span class="p">;</span>

  <span class="cm">/** Full readiness check (true if no failures) */</span>
  <span class="nx">isReady</span><span class="p">():</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="cm">/** Get uptime in seconds */</span>
  <span class="nx">getUptime</span><span class="p">():</span> <span class="kr">number</span><span class="p">;</span>

  <span class="cm">/** Get version string */</span>
  <span class="nx">getVersion</span><span class="p">():</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="types">Types</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">CheckResult</span> <span class="p">{</span>
  <span class="nl">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pass</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">fail</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">warn</span><span class="dl">'</span><span class="p">;</span>
  <span class="nl">message</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">timestamp</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">HealthCheckResponse</span> <span class="p">{</span>
  <span class="nl">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">healthy</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">unhealthy</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">degraded</span><span class="dl">'</span><span class="p">;</span>
  <span class="nl">checks</span><span class="p">:</span> <span class="p">{</span>
    <span class="p">[</span><span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">]:</span> <span class="p">{</span>
      <span class="na">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pass</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">fail</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">warn</span><span class="dl">'</span><span class="p">;</span>
      <span class="nl">message</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
      <span class="nl">timestamp</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">};</span>
  <span class="nl">version</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">uptime</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>  <span class="c1">// seconds</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">HealthCheckFn</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">CheckResult</span><span class="o">&gt;</span> <span class="o">|</span> <span class="nx">CheckResult</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">BuiltInCheckOptions</span> <span class="p">{</span>
  <span class="cm">/** Memory usage warning threshold (0-1). Default: 0.9 */</span>
  <span class="nl">memoryThreshold</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="cm">/** Event loop lag warning threshold in ms. Default: 100 */</span>
  <span class="nl">eventLoopLagThreshold</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="cm">/** ShutdownManager for shutdown state check */</span>
  <span class="nl">shutdownManager</span><span class="p">?:</span> <span class="nx">ShutdownManager</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="built-in-check-functions">Built-in Check Functions</h3>

<table>
  <thead>
    <tr>
      <th>Function</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">createMemoryCheck(threshold?)</code></td>
      <td>Check heap usage against threshold</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">createEventLoopCheck(threshold?)</code></td>
      <td>Check event loop lag</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">createShutdownCheck(shutdownManager)</code></td>
      <td>Check if server is shutting down</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">registerBuiltInChecks(checker, options?)</code></td>
      <td>Register all built-in checks</td>
    </tr>
  </tbody>
</table>

<h3 id="express-middleware">Express Middleware</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">healthMiddleware</span><span class="p">,</span> <span class="nx">HealthChecker</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">mcp-reference-server</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">healthChecker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HealthChecker</span><span class="p">({</span> <span class="na">version</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1.0.0</span><span class="dl">'</span> <span class="p">});</span>
<span class="nx">registerBuiltInChecks</span><span class="p">(</span><span class="nx">healthChecker</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">healthMiddleware</span><span class="p">(</span><span class="nx">healthChecker</span><span class="p">));</span>
<span class="c1">// Provides:</span>
<span class="c1">// GET /health - Liveness (always 200)</span>
<span class="c1">// GET /ready  - Readiness (200 or 503)</span>
</code></pre></div></div>

<h3 id="usage">Usage</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span>
  <span class="nx">HealthChecker</span><span class="p">,</span>
  <span class="nx">registerBuiltInChecks</span><span class="p">,</span>
  <span class="nx">healthMiddleware</span><span class="p">,</span>
<span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">mcp-reference-server</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">healthChecker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HealthChecker</span><span class="p">({</span> <span class="na">version</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1.0.0</span><span class="dl">'</span> <span class="p">});</span>

<span class="c1">// Register built-in checks</span>
<span class="nx">registerBuiltInChecks</span><span class="p">(</span><span class="nx">healthChecker</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">memoryThreshold</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
  <span class="na">eventLoopLagThreshold</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// Register custom check</span>
<span class="nx">healthChecker</span><span class="p">.</span><span class="nx">registerCheck</span><span class="p">(</span><span class="dl">'</span><span class="s1">database</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">connected</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">ping</span><span class="p">();</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="na">status</span><span class="p">:</span> <span class="nx">connected</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">pass</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">fail</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">message</span><span class="p">:</span> <span class="nx">connected</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">Connected</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">Connection failed</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="c1">// Check readiness</span>
<span class="k">if</span> <span class="p">(</span><span class="k">await</span> <span class="nx">healthChecker</span><span class="p">.</span><span class="nx">isReady</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Server is ready</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="metrics-observabilitymetrics">Metrics (<code class="language-plaintext highlighter-rouge">observability/metrics</code>)</h2>

<p>OpenTelemetry-based metrics collection for MCP server monitoring.</p>

<h3 id="constants">Constants</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">METRIC_NAMES</span><span class="p">,</span> <span class="nx">DURATION_BUCKETS</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">mcp-reference-server</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">METRIC_NAMES</span><span class="p">.</span><span class="nx">REQUESTS_TOTAL</span>     <span class="c1">// 'mcp.requests.total'</span>
<span class="nx">METRIC_NAMES</span><span class="p">.</span><span class="nx">REQUESTS_DURATION</span>  <span class="c1">// 'mcp.requests.duration'</span>
<span class="nx">METRIC_NAMES</span><span class="p">.</span><span class="nx">ERRORS_TOTAL</span>       <span class="c1">// 'mcp.errors.total'</span>
<span class="nx">METRIC_NAMES</span><span class="p">.</span><span class="nx">SESSIONS_ACTIVE</span>    <span class="c1">// 'mcp.sessions.active'</span>

<span class="c1">// Histogram bucket boundaries (milliseconds)</span>
<span class="nx">DURATION_BUCKETS</span>  <span class="c1">// [1, 5, 10, 25, 50, 100, 250, 500, 1000, 2500, 5000]</span>
</code></pre></div></div>

<h3 id="types-1">Types</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">MetricsSummary</span> <span class="p">{</span>
  <span class="nl">requests</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">total</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">byMethod</span><span class="p">:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">number</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="nl">byStatus</span><span class="p">:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">number</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nl">errors</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">total</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">byCode</span><span class="p">:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">number</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nl">sessions</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">active</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">RequestStatus</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">success</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">type</span> <span class="nx">TransportType</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">stdio</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="metricscollector-class">MetricsCollector Class</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">MetricsCollector</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">meter</span><span class="p">:</span> <span class="nx">Meter</span><span class="p">);</span>

  <span class="cm">/** Record a completed request */</span>
  <span class="nx">recordRequest</span><span class="p">(</span>
    <span class="nx">method</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">durationMs</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
    <span class="nx">status</span><span class="p">:</span> <span class="nx">RequestStatus</span><span class="p">,</span>
    <span class="nx">transport</span><span class="p">?:</span> <span class="nx">TransportType</span>
  <span class="p">):</span> <span class="k">void</span><span class="p">;</span>

  <span class="cm">/** Record an error */</span>
  <span class="nx">recordError</span><span class="p">(</span>
    <span class="nx">errorCode</span><span class="p">:</span> <span class="kr">number</span> <span class="o">|</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">method</span><span class="p">?:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">transport</span><span class="p">?:</span> <span class="nx">TransportType</span>
  <span class="p">):</span> <span class="k">void</span><span class="p">;</span>

  <span class="cm">/** Record session start */</span>
  <span class="nx">sessionStarted</span><span class="p">():</span> <span class="k">void</span><span class="p">;</span>

  <span class="cm">/** Record session end */</span>
  <span class="nx">sessionEnded</span><span class="p">():</span> <span class="k">void</span><span class="p">;</span>

  <span class="cm">/** Get metrics summary (for testing/debugging) */</span>
  <span class="nx">getMetrics</span><span class="p">():</span> <span class="nx">MetricsSummary</span><span class="p">;</span>

  <span class="cm">/** Reset internal counters (for testing) */</span>
  <span class="nx">resetMetrics</span><span class="p">():</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="factory-function">Factory Function</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">createMetricsCollector</span><span class="p">(</span>
  <span class="nx">telemetry</span><span class="p">:</span> <span class="nx">TelemetryManager</span><span class="p">,</span>
  <span class="nx">meterName</span><span class="p">?:</span> <span class="kr">string</span>  <span class="c1">// default: 'mcp-server'</span>
<span class="p">):</span> <span class="nx">MetricsCollector</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="usage-1">Usage</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">TelemetryManager</span><span class="p">,</span> <span class="nx">createMetricsCollector</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">mcp-reference-server</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">telemetry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TelemetryManager</span><span class="p">({</span> <span class="na">serviceName</span><span class="p">:</span> <span class="dl">'</span><span class="s1">my-mcp-server</span><span class="dl">'</span> <span class="p">});</span>
<span class="k">await</span> <span class="nx">telemetry</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">metrics</span> <span class="o">=</span> <span class="nx">createMetricsCollector</span><span class="p">(</span><span class="nx">telemetry</span><span class="p">);</span>

<span class="c1">// Record a successful request</span>
<span class="nx">metrics</span><span class="p">.</span><span class="nx">recordRequest</span><span class="p">(</span><span class="dl">'</span><span class="s1">tools/call</span><span class="dl">'</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="dl">'</span><span class="s1">success</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Record an error</span>
<span class="nx">metrics</span><span class="p">.</span><span class="nx">recordError</span><span class="p">(</span><span class="o">-</span><span class="mi">32600</span><span class="p">,</span> <span class="dl">'</span><span class="s1">tools/call</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Track sessions</span>
<span class="nx">metrics</span><span class="p">.</span><span class="nx">sessionStarted</span><span class="p">();</span>
<span class="c1">// ... later</span>
<span class="nx">metrics</span><span class="p">.</span><span class="nx">sessionEnded</span><span class="p">();</span>

<span class="c1">// Get summary (for debugging)</span>
<span class="kd">const</span> <span class="nx">summary</span> <span class="o">=</span> <span class="nx">metrics</span><span class="p">.</span><span class="nx">getMetrics</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">summary</span><span class="p">.</span><span class="nx">requests</span><span class="p">.</span><span class="nx">total</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="tracing-observabilitytracing">Tracing (<code class="language-plaintext highlighter-rouge">observability/tracing</code>)</h2>

<p>Distributed tracing support with W3C Trace Context propagation.</p>

<h3 id="types-2">Types</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">interface</span> <span class="nx">SpanContext</span> <span class="p">{</span>
  <span class="nl">traceId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">spanId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">traceFlags</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">Span</span> <span class="p">{</span>
  <span class="nx">setStatus</span><span class="p">(</span><span class="nx">status</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ok</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="nx">message</span><span class="p">?:</span> <span class="kr">string</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
  <span class="nx">setAttribute</span><span class="p">(</span><span class="nx">key</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">value</span><span class="p">:</span> <span class="kr">string</span> <span class="o">|</span> <span class="kr">number</span> <span class="o">|</span> <span class="nx">boolean</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
  <span class="nx">addEvent</span><span class="p">(</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">?:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span> <span class="o">|</span> <span class="kr">number</span> <span class="o">|</span> <span class="nx">boolean</span><span class="o">&gt;</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
  <span class="nx">end</span><span class="p">():</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">TracerOptions</span> <span class="p">{</span>
  <span class="nl">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">version</span><span class="p">?:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="tracer-class">Tracer Class</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nx">Tracer</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">:</span> <span class="nx">TracerOptions</span><span class="p">);</span>

  <span class="cm">/** Get tracer name */</span>
  <span class="nx">getName</span><span class="p">():</span> <span class="kr">string</span><span class="p">;</span>

  <span class="cm">/** Start a new span */</span>
  <span class="nx">startSpan</span><span class="p">(</span>
    <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
    <span class="nx">attributes</span><span class="p">?:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span> <span class="o">|</span> <span class="kr">number</span> <span class="o">|</span> <span class="nx">boolean</span><span class="o">&gt;</span>
  <span class="p">):</span> <span class="nx">Span</span><span class="p">;</span>

  <span class="cm">/** Extract trace context from headers (W3C Trace Context) */</span>
  <span class="nx">extractContext</span><span class="p">(</span><span class="nx">headers</span><span class="p">:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="o">&gt;</span><span class="p">):</span> <span class="nx">SpanContext</span> <span class="o">|</span> <span class="kc">null</span><span class="p">;</span>

  <span class="cm">/** Inject trace context into headers */</span>
  <span class="nx">injectContext</span><span class="p">(</span><span class="nx">context</span><span class="p">:</span> <span class="nx">SpanContext</span><span class="p">):</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="kr">string</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="factory-function-1">Factory Function</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">createTracer</span><span class="p">(</span><span class="nx">options</span><span class="p">:</span> <span class="nx">TracerOptions</span><span class="p">):</span> <span class="nx">Tracer</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="usage-2">Usage</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createTracer</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">mcp-reference-server</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">tracer</span> <span class="o">=</span> <span class="nx">createTracer</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mcp-server</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">version</span><span class="p">:</span> <span class="dl">'</span><span class="s1">1.0.0</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// Start a span for an operation</span>
<span class="kd">const</span> <span class="nx">span</span> <span class="o">=</span> <span class="nx">tracer</span><span class="p">.</span><span class="nx">startSpan</span><span class="p">(</span><span class="dl">'</span><span class="s1">tools/call</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="dl">'</span><span class="s1">mcp.method</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tools/call</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">mcp.tool</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">calculate</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="c1">// Do work</span>
  <span class="nx">span</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">result.type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">success</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">span</span><span class="p">.</span><span class="nx">setStatus</span><span class="p">(</span><span class="dl">'</span><span class="s1">ok</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">span</span><span class="p">.</span><span class="nx">setStatus</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
  <span class="nx">span</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="dl">'</span><span class="s1">exception</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">message</span><span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="p">});</span>
<span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
  <span class="nx">span</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="context-propagation">Context Propagation</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Extract context from incoming request</span>
<span class="kd">const</span> <span class="nx">parentContext</span> <span class="o">=</span> <span class="nx">tracer</span><span class="p">.</span><span class="nx">extractContext</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">headers</span><span class="p">);</span>

<span class="c1">// Inject context for outgoing request</span>
<span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="nx">tracer</span><span class="p">.</span><span class="nx">injectContext</span><span class="p">(</span><span class="nx">spanContext</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="related">Related</h2>

<ul>
  <li><a href="../guides/observability">Observability Guide</a> - Concepts and setup</li>
  <li><a href="../reference/environment">Environment Reference</a> - Configuration variables</li>
</ul>


<hr>

<div class="nav-footer">
  <p><strong>Navigation:</strong>
    <a href="/">Home</a> |
    <a href="/getting-started/installation">Getting Started</a> |
    <a href="/guides/protocol">Guides</a> |
    <a href="/api/protocol">API Reference</a> |
    <a href="/examples/stdio-server">Examples</a> |
    <a href="/reference/environment">Reference</a>
  </p>
</div>



      </section>
      <footer>
        
        <p>This project is maintained by <a href="https://github.com/chiefbuilder">chiefbuilder</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/assets/js/scale.fix.js"></script>
  </body>
</html>
